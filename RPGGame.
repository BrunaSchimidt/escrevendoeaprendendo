import random

# --------------------------- CONFIGURABLE DATA ---------------------------
PLAYER_MAX_HP   = 100        # Vida mÃ¡xima do jogador
POTION_HEAL     = 30         # Quanto cada poÃ§Ã£o cura
POTIONS_START   = 3          # PoÃ§Ãµes iniciais

ENEMIES_DATA = [
    {"name": "Slime",        "hp": 20,  "atk_min": 3,  "atk_max": 7},
    {"name": "Goblin",       "hp": 35,  "atk_min": 5,  "atk_max": 10},
    {"name": "Orc",          "hp": 50,  "atk_min": 8,  "atk_max": 14},
    {"name": "DragÃ£o",       "hp": 120, "atk_min": 10, "atk_max": 20},
    {"name": "CHEFÃƒO FINAL", "hp": 180, "atk_min": 12, "atk_max": 25},
]

# --------------------------- GENERATOR -----------------------------------

def gerar_inimigos():
    """Entrega (yield) um inimigo por vez, na ordem definida em ENEMIES_DATA."""
    for dados in ENEMIES_DATA:
        inimigo = dados.copy()        # cÃ³pia para nÃ£o alterar dados base
        inimigo["hp_atual"] = inimigo["hp"]
        yield inimigo
    yield {"name": "FIM"}           # marcador para encerrar o jogo

# --------------------------- FUNÃ‡Ã•ES AUXILIARES --------------------------

def dano_aleatorio(atk_min: int, atk_max: int) -> int:
    """Retorna um dano inteiro aleatÃ³rio dentro da faixa."""
    return random.randint(atk_min, atk_max)


def mostrar_status(player_hp: int, potions: int, inimigo: dict) -> None:
    """Exibe a HUD do combate."""
    print("-" * 50)
    print(f"ğŸ’š Vida: {player_hp}/{PLAYER_MAX_HP} | ğŸ§ª PoÃ§Ãµes: {potions}")
    if inimigo.get("hp_atual") is not None:  # nÃ£o mostra para o marcador FIM
        print(f"ğŸ‘¾ {inimigo['name']} â€“ HP: {inimigo['hp_atual']}/{inimigo['hp']}")
    print("-" * 50)

# --------------------------- COMBATE -------------------------------------

def loop_combate(player_hp: int, potions: int, inimigo: dict):
    """Lida com o combate contra *um* inimigo.

    Retorna:
        player_hp (int): vida restante do jogador
        potions   (int): quantidade de poÃ§Ãµes apÃ³s o combate
        fugiu     (bool): True se o jogador escapou
    """
    fugiu = False

    while inimigo["hp_atual"] > 0 and player_hp > 0:
        mostrar_status(player_hp, potions, inimigo)
        acao = input("[A]tacar | [P]oÃ§Ã£o | [F]ugir Â» ").strip().lower()

        if acao == "a":
            dano_jogador = dano_aleatorio(8, 15)
            inimigo["hp_atual"] = max(0, inimigo["hp_atual"] - dano_jogador)
            print(f"ğŸ’¥ VocÃª causou {dano_jogador} de dano!")

        elif acao == "p":
            if potions > 0:
                player_hp = min(PLAYER_MAX_HP, player_hp + POTION_HEAL)
                potions -= 1
                print(f"ğŸ§ª VocÃª usou uma poÃ§Ã£o e recuperou {POTION_HEAL} HP!")
            else:
                print("âš ï¸  VocÃª nÃ£o possui poÃ§Ãµes!")
                continue  # turno nÃ£o conta, inimigo nÃ£o ataca

        elif acao == "f":
            if random.random() < 0.5:
                print("ğŸƒ VocÃª conseguiu fugir!")
                fugiu = True
                break
            else:
                print("ğŸš« A fuga falhou!")
        else:
            print("â“ Comando invÃ¡lido.")
            continue  # nÃ£o consome turno

        # Ataque do inimigo (se ainda vivo e o jogador nÃ£o fugiu)
        if inimigo["hp_atual"] > 0 and not fugiu:
            dano_inimigo = dano_aleatorio(inimigo["atk_min"], inimigo["atk_max"])
            player_hp -= dano_inimigo
            print(f"ğŸ‘¾ {inimigo['name']} causou {dano_inimigo} de dano!")

    return player_hp, potions, fugiu

# --------------------------- LOOP PRINCIPAL ------------------------------

def jogar():
    print("\n=== RPG COM YIELD ===\nDerrote todos os inimigos ou morra tentando!\n")

    player_hp = PLAYER_MAX_HP
    potions   = POTIONS_START

    for inimigo in gerar_inimigos():
        if inimigo["name"] == "FIM":
            print("\nğŸ‰ VocÃª sobreviveu a todos os desafios! Fim do jogo.")
            break

        print(f"\nğŸ‘¾ Um {inimigo['name']} aproximaâ€‘se!")
        player_hp, potions, fugiu = loop_combate(player_hp, potions, inimigo)

        if player_hp <= 0:
            print("\nğŸ’€ VocÃª foi derrotado! Game Over.")
            break

        if fugiu:
            print(f"\nâš ï¸ VocÃª escapou do {inimigo['name']}. Ele ainda estÃ¡ Ã  solta!")
            # opcional: reinserir inimigo mais tarde ou pular para o prÃ³ximo
            continue

        # VitÃ³ria contra o inimigo
        print(f"\nâœ¨ {inimigo['name']} foi derrotado! Vida restante: {player_hp} HP.")

        # Chance de drop de poÃ§Ã£o (30Â %)
        if random.random() < 0.3:
            potions += 1
            print("ğŸ§ª VocÃª encontrou uma poÃ§Ã£o no corpo do inimigo!")

    print("\nObrigado por jogar!")


if __name__ == "__main__":
    jogar()
